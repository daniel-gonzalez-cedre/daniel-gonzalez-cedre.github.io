\newlist{detail}{itemize}{2}
\setlist[detail]{label={\boldmath$\cdot$},topsep=0pt,leftmargin=*,noitemsep}

\ifalgorithms
    \newcounter{nalg}[chapter]
    \renewcommand{\thenalg}{\thechapter.\arabic{nalg}}
    \DeclareCaptionLabelFormat{algocaption}{\it Algorithm \thenalg}

    \lstnewenvironment{algorithm}[1][]
    {
        \refstepcounter{nalg}
        \captionsetup{labelformat=algocaption,labelsep=colon}
        \lstset{
            mathescape=true,
            frame=tB,
            numbers=left,
            numberstyle=\tiny,
            basicstyle=\scriptsize,
            keywordstyle=\color{black}\bfseries\em,
            keywords={,input, output, return, datatype, function, in, if, else, elif, for, foreach, while, not, begin, end, true, false, null, break, continue, let, and, or, }
            numbers=left,
            xleftmargin=.04\textwidth,
            #1
        }
    }
    {}
\else
\fi

\ifindentproofs
    % begin new proof environment
    \expandafter\let\expandafter\oldproof\csname\string\proof\endcsname
    \let\oldendproof\endproof

    \renewenvironment{proof}[1][\proofname]{%
        \oldproof[#1]\quote~

    }{%
        %\endquote\oldendproof
        \endquote\qed
    }
    % end new proof environment
\else
\fi

\ifindenttheorems
    \newtheorem{pretheorem}{Theorem}
    \newtheorem{prelemma}{Lemma}
    \newtheorem{preproposition}{Proposition}
    \newtheorem{precorollary}{Corollary}
    \newtheorem{preclaim}{Claim}
    \newtheorem{preconjecture}{Conjecture}
    \newtheorem{prejustification}{Justification}

    \newtheorem{preaxiom}{Axiom}
    \newtheorem{predefinition}{Definition}
    \newtheorem{preexercise}{Exercise}
    \newtheorem{preexample}{Example}
    \newtheorem{precounterexample}{Counterexample}

    \newtheorem{preidea}{Idea}
    \newtheorem*{preremark}{Remark}
    \newtheorem*{prenote}{Note}

    % theorem
    \NewDocumentEnvironment{theorem}{O{} O{}}
        {\begin{pretheorem}[#1]~#2\quote\vspace{-0.75\parskip}}
        {\endquote\end{pretheorem}}
    % lemma
    \NewDocumentEnvironment{lemma}{O{} O{}}
        {\begin{prelemma}[#1]~#2\quote\vspace{-0.75\parskip}}
        {\endquote\end{prelemma}}
    % proposition
    \NewDocumentEnvironment{proposition}{O{} O{}}
        {\begin{preproposition}[#1]~#2\quote\vspace{-0.75\parskip}}
        {\endquote\end{preproposition}}
    % corollary
    \NewDocumentEnvironment{corollary}{O{} O{}}
        {\begin{precorollary}[#1]~#2\quote\vspace{-0.75\parskip}}
        {\endquote\end{precorollary}}
    % claim
    \NewDocumentEnvironment{claim}{O{} O{}}
        {\begin{preclaim}[#1]~#2\quote\vspace{-0.75\parskip}}
        {\endquote\end{preclaim}}
    % conjecture
    \NewDocumentEnvironment{conjecture}{O{} O{}}
        {\begin{preconjecture}[#1]~#2\quote\vspace{-0.75\parskip}}
        {\endquote\end{preconjecture}}
    % justification
    \NewDocumentEnvironment{justification}{O{} O{}}
        {\begin{prejustification}[#1]~#2\quote\vspace{-0.75\parskip}}
        {\endquote\end{prejustification}}

    % axiom
    \NewDocumentEnvironment{axiom}{O{} O{}}
        {\begin{preaxiom}[#1]~#2\quote\normalfont\vspace{-0.75\parskip}}
        {\endquote\end{preaxiom}}
    % definition
    \NewDocumentEnvironment{definition}{O{} O{}}
        {\begin{predefinition}[#1]~#2\quote\normalfont\vspace{-0.75\parskip}}
        {\endquote\end{predefinition}}
    % exercise
    \NewDocumentEnvironment{exercise}{O{} O{}}
        {\begin{preexercise}[#1]~#2\quote\normalfont\vspace{-0.75\parskip}}
        {\endquote\end{preexercise}}
    % example
    \NewDocumentEnvironment{example}{O{} O{}}
        {\begin{preexample}[#1]~#2\quote\normalfont\vspace{-0.75\parskip}}
        {\endquote\end{preexample}}
    % counterexample
    \NewDocumentEnvironment{counterexample}{O{} O{}}
        {\begin{precounterexample}[#1]~#2\quote\normalfont\vspace{-0.75\parskip}}
        {\endquote\end{precounterexample}}

    % idea
    \NewDocumentEnvironment{idea}{O{} O{}}
        {\begin{preidea}[#1]~#2\normalfont\vspace{-0.75\parskip}}
        {\end{preidea}}
    % remark
    \NewDocumentEnvironment{remark}{O{} O{}}
        {\begin{preremark}[#1]~#2\normalfont\vspace{-0.75\parskip}}
        {\end{preremark}}
    % note
    \NewDocumentEnvironment{note}{O{} O{}}
        {\begin{prenote}[#1]~#2\normalfont\vspace{-0.75\parskip}}
        {\end{prenote}}
\else
    \theoremstyle{thm}% style for theorems
    \newtheorem{theorem}{Theorem}
    \newtheorem{lemma}{Lemma}
    \newtheorem{proposition}{Proposition}
    \newtheorem{corollary}{Corollary}
    \newtheorem{claim}{Claim}
    \newtheorem{conjecture}{Conjecture}
    \newtheorem{justification}{Justification}

    \theoremstyle{dfn}% style for definitions
    \newtheorem{axiom}{Axiom}
    \newtheorem{definition}{Definition}
    \newtheorem{exercise}{Exercise}
    \newtheorem{example}{Example}
    \newtheorem{counterexample}{Counterexample}

    \theoremstyle{rmk}% style for remarks
    \newtheorem{idea}{Idea}
    \newtheorem*{remark}{Remark}
    \newtheorem*{note}{Note}
\fi

\newenvironment{case}[1][Case]
    {\textbf{#1:}\quote}
    {\endquote}

\def\lstlistingautorefname{Algorithm}
\def\itemautorefname{Section}
\renewcommand{\chapterautorefname}{Chapter}
\renewcommand{\sectionautorefname}{Section}
\newcommand{\pretheoremautorefname}{Theorem}
\newcommand{\preaxiomautorefname}{Axiom}
\newcommand{\prelemmaautorefname}{Lemma}
\newcommand{\prepropositionautorefname}{Proposition}
\newcommand{\precorollaryautorefname}{Corollary}
\newcommand{\preclaimautorefname}{Claim}
\newcommand{\preconjectureautorefname}{Conjecture}
\newcommand{\prejustificationautorefname}{Justification}
\newcommand{\predefinitionautorefname}{Definition}
\newcommand{\preexampleautorefname}{Example}
\newcommand{\precounterexampleautorefname}{Counterexample}
\newcommand{\preideaautorefname}{Idea}
\newcommand{\axiomautorefname}{Axiom}
\newcommand{\lemmaautorefname}{Lemma}
\newcommand{\propositionautorefname}{Proposition}
\newcommand{\corollaryautorefname}{Corollary}
\newcommand{\claimautorefname}{Claim}
\newcommand{\conjectureautorefname}{Conjecture}
\newcommand{\justificationautorefname}{Justification}
\newcommand{\definitionautorefname}{Definition}
\newcommand{\exampleautorefname}{Example}
\newcommand{\counterexampleautorefname}{Counterexample}
\newcommand{\ideaautorefname}{Idea}

\ifbook
    \renewcommand{\theequation}{\thechapter.\arabic{equation}}
    \renewcommand{\thepretheorem}{\thechapter.\arabic{pretheorem}}
    \renewcommand{\theprelemma}{\thechapter.\arabic{prelemma}}
    \renewcommand{\thepreproposition}{\thechapter.\arabic{preproposition}}
    \renewcommand{\theprecorollary}{\thechapter.\arabic{precorollary}}
    \renewcommand{\thepreclaim}{\thechapter.\arabic{preclaim}}
    \renewcommand{\thepreconjecture}{\thechapter.\arabic{preconjecture}}
    \renewcommand{\theprejustification}{\thechapter.\arabic{prejustification}}
    \renewcommand{\thepredefinition}{\thechapter.\arabic{predefinition}}
    \renewcommand{\thepreexample}{\thechapter.\arabic{preexample}}
    \renewcommand{\theprecounterexample}{\thechapter.\arabic{precounterexample}}
    \counterwithin*{equation}{chapter}
    \counterwithin*{pretheorem}{chapter}
    \counterwithin*{prelemma}{chapter}
    \counterwithin*{preproposition}{chapter}
    \counterwithin*{precorollary}{chapter}
    \counterwithin*{preclaim}{chapter}
    \counterwithin*{preconjecture}{chapter}
    \counterwithin*{prejustification}{chapter}
    \counterwithin*{predefinition}{chapter}
    \counterwithin*{preexercise}{chapter}
    \counterwithin*{preexample}{chapter}
    \counterwithin*{precounterexample}{chapter}
\else
\fi
